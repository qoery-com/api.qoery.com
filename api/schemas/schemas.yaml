components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        code:
          type: integer
        message:
          type: string
          description: Additional error message
        details:
          type: string
          nullable: true
      required:
        - error
        - code

    EndpointUsageStats:
      type: object
      description: Usage statistics for a specific endpoint
      properties:
        calls_used:
          type: integer
          description: Number of calls used in current period
        calls_limit:
          type: string
          description: Maximum calls allowed in current period (returned as string)
        tokens_in:
          type: integer
          description: Total input tokens consumed in current period
        tokens_out:
          type: integer
          description: Total output tokens consumed in current period
        errors:
          type: integer
          description: Total number of errors in current period
        remaining:
          type: integer
          description: Number of calls remaining in current period
      required:
        - calls_used
        - calls_limit
        - tokens_in
        - tokens_out
        - errors
        - remaining

    UsageStats:
      type: object
      description: Usage statistics per endpoint
      properties:
        period_start:
          type: string
          format: date-time
          description: Start of the current usage period
        period_end:
          type: string
          format: date-time
          description: End of the current usage period
        plan:
          type: string
          description: Current subscription plan
        endpoints:
          type: object
          description: Usage statistics broken down by endpoint
          properties:
            nl:
              $ref: '#/components/schemas/EndpointUsageStats'
            scrape:
              $ref: '#/components/schemas/EndpointUsageStats'
            plot2table:
              $ref: '#/components/schemas/EndpointUsageStats'
          required:
            - nl
            - scrape
            - plot2table
      required:
        - period_start
        - period_end
        - plan
        - endpoints


    # Removed deprecated QueryMetadata in favor of QueryMeta

    QueryResponse:
      type: object
      description: Response from natural language query endpoint
      properties:
        series:
          type: array
          description: Array of series, each with its observations
          items:
            $ref: '#/components/schemas/Series'
        meta:
          $ref: '#/components/schemas/QueryMeta'
        description:
          type: string
          description: Natural language description of the query result
          nullable: true
      required:
        - series
        - meta

    NLQueryRequest:
      type: object
      properties:
        query:
          type: string
          description: Natural language query
        num_results:
          type: integer
          description: Number of search results to process
          minimum: 1
          maximum: 100
          default: 10
        paragraph_extraction:
          type: boolean
          description: Enable paragraph-based time-series extraction
          default: false
        plot2table:
          type: integer
          description: Number of charts/images to process with plot2table
          minimum: 0
          default: 0
      required:
        - query




    ObservationPoint:
      type: object
      description: A single data point within a specific series
      properties:
        dimension:
          type: string
          description: The dimension/axis value (timestamp for time series, category for categorical data, x-value for scatter plots, etc.)
        value:
          oneOf:
            - type: number
            - type: string
            - type: boolean
          description: Value of the observation at this dimension point
      required:
        - dimension
        - value

    Series:
      type: object
      description: A data series with observations from a specific source
      properties:
        url:
          type: string
          format: uri
          description: URL of the source page
        title:
          type: string
          description: Title of the series
        url_title:
          type: string
          description: Title from the URL/source
        observations:
          type: array
          description: The ordered observations for this series
          items:
            $ref: '#/components/schemas/ObservationPoint'
        relevance_score:
          type: number
          description: Relevance score for this series (0-1)
      required:
        - url
        - title
        - url_title
        - observations
        - relevance_score

    QueryMeta:
      type: object
      description: Metadata about query execution and pagination
      properties:
        result_count:
          type: integer
          description: Number of results returned in this response
        page:
          $ref: '#/components/schemas/PageInfo'
        diagnostics:
          type: object
          description: Additional diagnostic information about the query execution
          additionalProperties: true
      required:
        - result_count

    PageInfo:
      type: object
      description: Pagination information for the response
      properties:
        limit:
          type: integer
          description: Number of items requested per page
        offset:
          type: integer
          description: Offset index of the first item in this page
        next_cursor:
          type: string
          description: Opaque token to fetch the next page
          nullable: true
        has_more:
          type: boolean
          description: Whether there are more items available beyond this page
      required:
        - limit
        - offset
        - has_more

    URLRequest:
      type: object
      properties:
        url:
          type: string
          format: uri
          description: URL to scrape
        query:
          type: string
          description: Optional user query to guide extraction
          nullable: true
        paragraph_extraction:
          type: boolean
          description: Enable paragraph-based time-series extraction
          default: false
        plot2table:
          type: integer
          description: Number of charts/images to process with plot2table
          minimum: 0
          default: 0
      required:
        - url

    ImageURLRequest:
      type: object
      properties:
        image_url:
          type: string
          format: uri
          description: URL of the image containing charts or graphs to convert to data table
      required:
        - image_url

    PlanPrice:
      type: object
      properties:
        amount:
          type: number
        currency:
          type: string
        priceId:
          type: string

    Plan:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        price:
          type: string
          description: Human-friendly display price
        billing:
          type: string
          description: Billing cadence for display (e.g., monthly, annual, one-time)
        limits:
          type: object
          additionalProperties:
            type: integer
          description: Monthly limits keyed by endpoint (e.g., 'query/nl', 'scrape', 'plot2table')
        api_keys:
          oneOf:
            - type: integer
            - type: string
          description: Number of API keys included (or 'unlimited')
        support:
          type: string
        monthlyPrice:
          allOf:
            - $ref: '#/components/schemas/PlanPrice'
          nullable: true
        annualPrice:
          allOf:
            - $ref: '#/components/schemas/PlanPrice'
          nullable: true
        discountPercentage:
          type: number
          nullable: true

    PlansResponse:
      type: object
      properties:
        plans:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/Plan'
        default_plan:
          type: string
      required:
        - plans
        - default_plan

    ScrapeArtifacts:
      type: object
      description: URLs to stored artifacts
      properties:
        html_url:
          type: string
          description: URL to stored HTML
        markdown_url:
          type: string
          description: URL to stored markdown
        tables_base_url:
          type: string
          description: Base URL for stored tables

    ScrapeResponse:
      type: object
      description: Response from web scraping endpoint
      properties:
        series:
          type: array
          description: Array of series with observations (same structure as query endpoints)
          items:
            $ref: '#/components/schemas/Series'
        artifacts:
          $ref: '#/components/schemas/ScrapeArtifacts'
        cached:
          type: boolean
          description: Whether this result was retrieved from cache
        source_id:
          type: string
          description: Database source ID (present when cached=true)
          nullable: true
        metadata:
          type: object
          description: Additional metadata about the scrape
          properties:
            result_count:
              type: integer
              description: Number of observations extracted
          additionalProperties: true
      required:
        - series
